"use strict";(globalThis["webpackChunkfirebaseaut"]=globalThis["webpackChunkfirebaseaut"]||[]).push([[467],{8467:(e,t,l)=>{l.r(t),l.d(t,{default:()=>oe});var a=l(9835),s=l(6970);const r={class:"row"},i=(0,a._)("div",{class:"col-8"},null,-1),o={class:"col-4"},n={class:"row"},c={key:0,class:"col-8"},d={key:1,class:"col-8"},u={class:"text-h5 text-weight-light text-uppercase q-mb-sm"},p={class:"flex justify-end"},m={class:"q-pt-lg q-pb-lg",style:{width:"100%"}},g={class:"flex items-center"},w={class:"q-mr-md"},v=["src"],h={class:"q-ml-md"},f={class:"col-4"},b={class:"q-pl-xl"},y=(0,a._)("div",{class:"text-h5 text-weight-light text-uppercase"}," Payable Amount ",-1),x={class:"text-h5 text-weight-light text-uppercase q-mb-md",style:{color:"#d89f65"}},_=(0,a._)("div",{class:"flex justify-between q-mt-lg"},null,-1),k={class:"flex justify-between items-center"},q=(0,a._)("div",null,[(0,a._)("div",{class:"text-subtitle2 text-uppercase"}," Add Cash Received: ")],-1),P={class:"q-pt-md q-pb-md"},I={class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},C=(0,a._)("div",null,"Subtotal",-1),W={class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},O=(0,a._)("div",null,"Change",-1),Z={key:0},T={key:1},Q=(0,a._)("div",{class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},[(0,a._)("div",null,[(0,a.Uk)(" Service Charge "),(0,a._)("span",{class:"text-weight-light q-ml-sm"},"0%")]),(0,a._)("div",null,"0")],-1),j={class:"flex justify-between text-uppercase text-weight-light text-h5"},R=(0,a._)("div",null,"Total",-1),z={class:"q-mt-xl"},D={key:0};function E(e,t,l,E,H,U){const S=(0,a.up)("q-separator"),J=(0,a.up)("q-banner"),V=(0,a.up)("q-checkbox"),A=(0,a.up)("q-btn"),F=(0,a.up)("q-td"),L=(0,a.up)("q-tr"),N=(0,a.up)("q-table"),Y=(0,a.up)("q-input"),B=(0,a.up)("q-card-section"),K=(0,a.up)("q-card"),M=(0,a.up)("q-spinner-hourglass"),$=(0,a.up)("q-page");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",r,[i,(0,a._)("div",o,[(0,a.Wm)(S,{vertical:"",style:{color:"#d8dbd9",height:"100vh",position:"fixed","margin-left":"15px"}})])]),(0,a.Wm)($,{class:"q-ma-lg",style:{"min-height":"0 !important"}},{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a._)("div",n,[0===E.orders.length?((0,a.wg)(),(0,a.iD)("div",c,[(0,a.Wm)(J,{"inline-actions":"",class:"text-white bg-red"},{default:(0,a.w5)((()=>[(0,a.Uk)(" No order found. ")])),_:1})])):((0,a.wg)(),(0,a.iD)("div",d,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Object.keys(E.segregatedOrders),(e=>((0,a.wg)(),(0,a.iD)("div",{key:e},[(0,a._)("div",u," order #: "+(0,s.zw)(e),1),(0,a._)("div",p,[(0,a.Wm)(V,{style:{position:"relative",top:"-10px"},modelValue:E.selectedTables,"onUpdate:modelValue":t[0]||(t[0]=e=>E.selectedTables=e),val:e,dense:""},null,8,["modelValue","val"])]),(0,a.Wm)(N,{class:"q-mb-lg",flat:"",bordered:"",title:"Treats",columns:E.columns,"row-key":"name","binary-state-sort":"",rows:E.segregatedOrders[e],pagination:E.pagination},{top:(0,a.w5)((()=>[(0,a._)("div",m,[(0,a.Wm)(A,{push:"",class:"text-uppercase text-black text-weight-light full-width text-h6",color:"red",label:"Cancel Order",onClick:t=>E.cancelOrder(e)},null,8,["onClick"])])])),body:(0,a.w5)((t=>[(0,a.Wm)(L,{props:t},{default:(0,a.w5)((()=>[(0,a.Wm)(F,{key:"item",props:t},{default:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a._)("span",w,(0,s.zw)(t.rowIndex+1),1),(0,a._)("img",{src:t.row.image,alt:"Item Image",style:{width:"50px",height:"50px","object-fit":"cover"}},null,8,v),(0,a._)("span",h,(0,s.zw)(t.row.name),1)])])),_:2},1032,["props"]),(0,a.Wm)(F,{key:"price",props:t},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(t.row.price),1)])),_:2},1032,["props"]),(0,a.Wm)(F,{key:"qty",props:t},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(t.row.order_quantity),1)])),_:2},1032,["props"]),(0,a.Wm)(F,{key:"actions",props:t},{default:(0,a.w5)((()=>[(0,a.Wm)(A,{onClick:l=>E.removeItem(t.row.itemId,e,t.row.name),color:"red",icon:"delete"},null,8,["onClick"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},1032,["columns","rows","pagination"])])))),128))])),(0,a._)("div",f,[(0,a._)("div",b,[y,(0,a._)("div",x," P"+(0,s.zw)(E.totalPrice),1),(0,a.Wm)(S,{style:{color:"#d8dbd9"}}),_,(0,a._)("div",null,[(0,a.Wm)(K,{class:"q-mt-lg",style:{background:"#eaf0f0"}},{default:(0,a.w5)((()=>[(0,a.Wm)(B,null,{default:(0,a.w5)((()=>[(0,a._)("div",k,[q,(0,a._)("div",null,[(0,a.Wm)(Y,{"input-style":{fontSize:"20px"},modelValue:E.cashReceived,"onUpdate:modelValue":t[1]||(t[1]=e=>E.cashReceived=e),dense:E.dense},null,8,["modelValue","dense"])])])])),_:1})])),_:1})]),(0,a._)("div",P,[(0,a._)("div",I,[C,(0,a._)("div",null,"P"+(0,s.zw)(E.totalPrice),1)]),(0,a._)("div",W,[O,E.cashReceived>E.totalPrice?((0,a.wg)(),(0,a.iD)("div",Z," P"+(0,s.zw)(E.cashReceived-E.totalPrice),1)):((0,a.wg)(),(0,a.iD)("div",T,"P0"))]),Q]),(0,a.Wm)(S,{class:"q-mb-xl",style:{color:"#d8dbd9"}}),(0,a._)("div",j,[R,(0,a._)("div",null,"P"+(0,s.zw)(E.totalPrice),1)]),(0,a._)("div",z,[!E.cashReceived||E.cashReceived<E.totalPrice||!E.totalPrice?((0,a.wg)(),(0,a.j4)(A,{key:0,disabled:"",style:{background:"#8bb5be",width:"100%"},class:"text-uppercase text-h5"},{default:(0,a.w5)((()=>[(0,a.Uk)("Pay Now")])),_:1})):((0,a.wg)(),(0,a.j4)(A,{key:1,onClick:E.paynow,style:{background:"#8bb5be",width:"100%"},class:"text-uppercase text-h5",disable:E.loading},{default:(0,a.w5)((()=>[E.loading?((0,a.wg)(),(0,a.j4)(M,{key:1,color:"white"})):((0,a.wg)(),(0,a.iD)("span",D,"Pay Now"))])),_:1},8,["onClick","disable"]))])])])])])])),_:1})],64)}l(9665),l(6727);var H=l(499),U=l(9302),S=(l(6827),l(222)),J=l(6605),V=l(9017);const A=[{name:"item",required:!0,label:"ITEM",align:"left",field:e=>e.name,sortable:!0},{name:"price",align:"left",label:"PRICE",field:e=>e.price,sortable:!0},{name:"qty",align:"left",label:"QTY",field:e=>e.order_quantity,sortable:!0},{name:"actions",align:"right",label:"Actions",field:"actions",sortable:!0}],F={setup(){const e=(0,H.iH)(!1),t=(0,U.Z)(),l=(0,H.iH)([]),s=(0,H.iH)(null),r=(0,H.iH)(""),i=(0,H.iH)([]),o=(0,a.FN)().appContext.config.globalProperties,n=(0,S.ZF)(o.$firebaseConfig),c=(0,V.ad)(n),d=(0,H.iH)({page:1,rowsPerPage:10,sortBy:"desc",descending:!1}),u=(0,a.Fl)((()=>{const e=[];for(const t of l.value)m.value.hasOwnProperty(t)&&e.push(...m.value[t]);return e})),p=(0,a.Fl)((()=>u.value.reduce(((e,t)=>e+t.total),0))),m=(0,a.Fl)((()=>{const e={};return i.value.forEach((t=>{const l=t.orderId;e[l]||(e[l]=[]);const a=t.orders.map((e=>{const t=e.price*e.order_quantity;return{...e,total:t,actions:null}}));e[l].push(...a)})),e}));async function g(){const e=(0,J.v0)().currentUser;if(e){const t=(0,V.IO)((0,V.hJ)(c,"orders")),l=await(0,V.PL)(t),a=[];l.docs.forEach((t=>{const l=t.data();Array.isArray(l.orders)&&l.orders.length>0&&l.userId===e.uid&&"unpaid"===l.payment_status&&a.push(l)})),i.value=a}}async function w(e){const t=(0,V.IO)((0,V.hJ)(c,"orders"),(0,V.ar)("orderId","==",e)),l=await(0,V.PL)(t);l.forEach((async e=>{await(0,V.oe)(e.ref)})),i.value=i.value.filter((t=>t.orderId!==e))}async function v(){const a=(0,J.v0)().currentUser;if(a){const a=l.value,o=i.value.filter((e=>a.includes(e.orderId)));if(console.log("Selected Order IDs:",a),console.log("Matching Orders:",o),o.length>0){const i=s.value,n=p.value,d=i-n;try{e.value=!0;for(const e of a){const t=(0,V.IO)((0,V.hJ)(c,"orders"),(0,V.ar)("orderId","==",e)),l=await(0,V.PL)(t);l.forEach((async e=>{const t=e.ref;console.log("Order Doc Ref:",t),await(0,V.r7)(t,{payment_status:"paid"})}))}const r={orders:o.map((e=>({...e,payment_status:"paid"}))),cashReceived:i,change:d>0?d:0,timestamp:V.EK.now()},n=(0,V.hJ)(c,"report");await(0,V.ET)(n,r),l.value=[],s.value=null,setTimeout((()=>{e.value=!1,t.notify({message:"Payment successful!",position:"top",timeout:2e3})}),500),await g()}catch(r){console.error("Error while processing payment:",r),e.value=!1}}}}async function h(e,t,l){try{const a=(0,V.ad)(n),s=(0,V.IO)((0,V.hJ)(a,"orders"),(0,V.ar)("orderId","==",t)),r=await(0,V.PL)(s);if(!r.empty){const t=r.docs[0],s=(0,V.JU)(a,"orders",t.id),i=t.data(),o=i.orders.findIndex((t=>t.itemId===e&&t.name===l));-1!==o&&(i.orders.splice(o,1),await(0,V.pl)(s,i)),await g()}}catch(a){console.error("Error removing item:",a)}}return(0,a.YP)(l,(e=>{0===e.length&&(s.value=null)})),(0,a.bv)(g),{removeItem:h,loading:e,paynow:v,selectedTables:l,cashReceived:s,uuid:r,orders:i,columns:A,selectedOrders:u,totalPrice:p,segregatedOrders:m,cancelOrder:w,dense:(0,H.iH)(!1),pagination:d}}};var L=l(1639),N=l(926),Y=l(9885),B=l(7128),K=l(1221),M=l(6008),$=l(4455),G=l(3532),X=l(7220),ee=l(4458),te=l(3190),le=l(3119),ae=l(3358),se=l(9984),re=l.n(se);const ie=(0,L.Z)(F,[["render",E]]),oe=ie;re()(F,"components",{QSeparator:N.Z,QPage:Y.Z,QBanner:B.Z,QCheckbox:K.Z,QTable:M.Z,QBtn:$.Z,QTr:G.Z,QTd:X.Z,QCard:ee.Z,QCardSection:te.Z,QInput:le.Z,QSpinnerHourglass:ae.Z})}}]);