"use strict";(globalThis["webpackChunkfirebaseaut"]=globalThis["webpackChunkfirebaseaut"]||[]).push([[328],{7328:(e,t,l)=>{l.r(t),l.d(t,{default:()=>oe});var s=l(9835),a=l(6970);const r={class:"row"},i=(0,s._)("div",{class:"col-8"},null,-1),o={class:"col-4"},n={class:"row"},c={key:0,class:"col-8"},d={key:1,class:"col-8"},u={class:"text-h5 text-weight-light text-uppercase q-mb-sm"},p={class:"flex justify-end"},g={class:"q-pt-lg q-pb-lg",style:{width:"100%"}},w={class:"flex items-center"},m={class:"q-mr-md"},v=["src"],h={class:"q-ml-md"},f={class:"col-4"},b={class:"q-pl-xl"},y=(0,s._)("div",{class:"text-h5 text-weight-light text-uppercase"}," Payable Amount ",-1),x={class:"text-h5 text-weight-light text-uppercase q-mb-md",style:{color:"#d89f65"}},_=(0,s._)("div",{class:"flex justify-between q-mt-lg"},null,-1),q={class:"flex justify-between items-center"},k=(0,s._)("div",null,[(0,s._)("div",{class:"text-subtitle2 text-uppercase"}," Add Cash Received ")],-1),P={class:"q-pt-md q-pb-md"},C={class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},I=(0,s._)("div",null,"Subtotal",-1),O={class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},W=(0,s._)("div",null,"Change",-1),Z={key:0},T={key:1},Q=(0,s._)("div",{class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},[(0,s._)("div",null,[(0,s.Uk)(" Service Charge "),(0,s._)("span",{class:"text-weight-light q-ml-sm"},"0%")]),(0,s._)("div",null,"0")],-1),j={class:"flex justify-between text-uppercase text-weight-light text-h5"},R=(0,s._)("div",null,"Total",-1),z={class:"q-mt-xl"},D={key:0};function H(e,t,l,H,E,U){const S=(0,s.up)("q-separator"),V=(0,s.up)("q-banner"),F=(0,s.up)("q-checkbox"),A=(0,s.up)("q-btn"),J=(0,s.up)("q-td"),N=(0,s.up)("q-tr"),Y=(0,s.up)("q-table"),B=(0,s.up)("q-input"),L=(0,s.up)("q-card-section"),K=(0,s.up)("q-card"),M=(0,s.up)("q-spinner-hourglass"),$=(0,s.up)("q-page");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",r,[i,(0,s._)("div",o,[(0,s.Wm)(S,{vertical:"",style:{color:"#d8dbd9",height:"100vh",position:"fixed"}})])]),(0,s.Wm)($,{class:"q-ma-lg",style:{"min-height":"0 !important"}},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s._)("div",n,[0===H.orders.length?((0,s.wg)(),(0,s.iD)("div",c,[(0,s.Wm)(V,{"inline-actions":"",class:"text-white bg-red"},{default:(0,s.w5)((()=>[(0,s.Uk)(" No order found. ")])),_:1})])):((0,s.wg)(),(0,s.iD)("div",d,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(Object.keys(H.segregatedOrders),(e=>((0,s.wg)(),(0,s.iD)("div",{key:e},[(0,s._)("div",u," order #: "+(0,a.zw)(e),1),(0,s._)("div",p,[(0,s.Wm)(F,{style:{position:"relative",top:"-10px"},modelValue:H.selectedTables,"onUpdate:modelValue":t[0]||(t[0]=e=>H.selectedTables=e),val:e,dense:""},null,8,["modelValue","val"])]),(0,s.Wm)(Y,{class:"q-mb-lg",flat:"",bordered:"",title:"Treats",columns:H.columns,"row-key":"name","binary-state-sort":"",rows:H.segregatedOrders[e],pagination:H.pagination},{top:(0,s.w5)((()=>[(0,s._)("div",g,[(0,s.Wm)(A,{push:"",class:"text-uppercase text-black text-weight-light full-width text-h6",color:"red",label:"Cancel Order",onClick:t=>H.cancelOrder(e)},null,8,["onClick"])])])),body:(0,s.w5)((e=>[(0,s.Wm)(N,{props:e},{default:(0,s.w5)((()=>[(0,s.Wm)(J,{key:"item",props:e},{default:(0,s.w5)((()=>[(0,s._)("div",w,[(0,s._)("span",m,(0,a.zw)(e.rowIndex+1),1),(0,s._)("img",{src:e.row.image,alt:"Item Image",style:{width:"50px",height:"50px","object-fit":"cover"}},null,8,v),(0,s._)("span",h,(0,a.zw)(e.row.name),1)])])),_:2},1032,["props"]),(0,s.Wm)(J,{key:"price",props:e},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.row.price),1)])),_:2},1032,["props"]),(0,s.Wm)(J,{key:"qty",props:e},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.row.order_quantity),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},1032,["columns","rows","pagination"])])))),128))])),(0,s._)("div",f,[(0,s._)("div",b,[y,(0,s._)("div",x," P"+(0,a.zw)(H.totalPrice),1),(0,s.Wm)(S,{style:{color:"#d8dbd9"}}),_,(0,s._)("div",null,[(0,s.Wm)(K,{class:"q-mt-lg",style:{background:"#eaf0f0"}},{default:(0,s.w5)((()=>[(0,s.Wm)(L,null,{default:(0,s.w5)((()=>[(0,s._)("div",q,[k,(0,s._)("div",null,[(0,s.Wm)(B,{"input-style":{fontSize:"20px"},modelValue:H.cashReceived,"onUpdate:modelValue":t[1]||(t[1]=e=>H.cashReceived=e),dense:H.dense},null,8,["modelValue","dense"])])])])),_:1})])),_:1})]),(0,s._)("div",P,[(0,s._)("div",C,[I,(0,s._)("div",null,"P"+(0,a.zw)(H.totalPrice),1)]),(0,s._)("div",O,[W,H.cashReceived>H.totalPrice?((0,s.wg)(),(0,s.iD)("div",Z," P"+(0,a.zw)(H.cashReceived-H.totalPrice),1)):((0,s.wg)(),(0,s.iD)("div",T,"P0"))]),Q]),(0,s.Wm)(S,{class:"q-mb-xl",style:{color:"#d8dbd9"}}),(0,s._)("div",j,[R,(0,s._)("div",null,"P"+(0,a.zw)(H.totalPrice),1)]),(0,s._)("div",z,[!H.cashReceived||H.cashReceived<H.totalPrice?((0,s.wg)(),(0,s.j4)(A,{key:0,disabled:"",style:{background:"#8bb5be",width:"100%"},class:"text-uppercase text-h5"},{default:(0,s.w5)((()=>[(0,s.Uk)("Pay Now")])),_:1})):((0,s.wg)(),(0,s.j4)(A,{key:1,onClick:H.paynow,style:{background:"#8bb5be",width:"100%"},class:"text-uppercase text-h5",disable:H.loading},{default:(0,s.w5)((()=>[H.loading?((0,s.wg)(),(0,s.j4)(M,{key:1,color:"white"})):((0,s.wg)(),(0,s.iD)("span",D,"Pay Now"))])),_:1},8,["onClick","disable"]))])])])])])])),_:1})],64)}l(9665),l(6727);var E=l(499),U=l(9302),S=(l(6827),l(222)),V=l(6605),F=l(9017);const A=[{name:"item",required:!0,label:"ITEM",align:"left",field:e=>e.name,sortable:!0},{name:"price",align:"center",label:"PRICE",field:e=>e.price,sortable:!0},{name:"qty",label:"QTY",field:e=>e.order_quantity,sortable:!0}],J={setup(){const e=(0,E.iH)(!1),t=(0,U.Z)(),l=(0,E.iH)([]),a=(0,E.iH)(null),r=(0,E.iH)(""),i=(0,E.iH)([]),o=(0,s.FN)().appContext.config.globalProperties,n=(0,S.ZF)(o.$firebaseConfig),c=(0,F.ad)(n),d=(0,E.iH)({page:1,rowsPerPage:10,sortBy:"desc",descending:!1}),u=(0,s.Fl)((()=>{const e=[];for(const t of l.value)g.value.hasOwnProperty(t)&&e.push(...g.value[t]);return e})),p=(0,s.Fl)((()=>u.value.reduce(((e,t)=>e+t.total),0))),g=(0,s.Fl)((()=>{const e={};return i.value.forEach((t=>{const l=t.orderId;e[l]||(e[l]=[]);const s=t.orders.map((e=>{const t=e.price*e.order_quantity;return{...e,total:t,actions:null}}));e[l].push(...s)})),e}));async function w(){const e=(0,V.v0)().currentUser;if(e){const t=(0,F.IO)((0,F.hJ)(c,"orders")),l=await(0,F.PL)(t),s=[];l.docs.forEach((t=>{const l=t.data();Array.isArray(l.orders)&&l.orders.length>0&&l.userId===e.uid&&"unpaid"===l.payment_status&&s.push(l)})),i.value=s}}async function m(e){const t=(0,F.IO)((0,F.hJ)(c,"orders"),(0,F.ar)("orderId","==",e)),l=await(0,F.PL)(t);l.forEach((async e=>{await(0,F.oe)(e.ref)})),i.value=i.value.filter((t=>t.orderId!==e))}async function v(){const s=(0,V.v0)().currentUser;if(s){const s=l.value,o=i.value.filter((e=>s.includes(e.orderId)));if(console.log("Selected Order IDs:",s),console.log("Matching Orders:",o),o.length>0){const i=a.value,n=p.value,d=i-n;try{e.value=!0;for(const e of s){const t=(0,F.IO)((0,F.hJ)(c,"orders"),(0,F.ar)("orderId","==",e)),l=await(0,F.PL)(t);l.forEach((async e=>{const t=e.ref;console.log("Order Doc Ref:",t),await(0,F.r7)(t,{payment_status:"paid"})}))}const r={orders:o.map((e=>({...e,payment_status:"paid"}))),cashReceived:i,change:d>0?d:0,timestamp:F.EK.now()},n=(0,F.hJ)(c,"report");await(0,F.ET)(n,r),l.value=[],a.value=null,setTimeout((()=>{e.value=!1,t.notify({message:"Payment successful!",position:"top",timeout:2e3})}),500),await w()}catch(r){console.error("Error while processing payment:",r),e.value=!1}}}}return(0,s.YP)(l,(e=>{0===e.length&&(a.value=null)})),(0,s.bv)(w),{loading:e,paynow:v,selectedTables:l,cashReceived:a,uuid:r,orders:i,columns:A,selectedOrders:u,totalPrice:p,segregatedOrders:g,cancelOrder:m,dense:(0,E.iH)(!1),pagination:d}}};var N=l(1639),Y=l(926),B=l(9885),L=l(7128),K=l(1221),M=l(6008),$=l(4455),G=l(3532),X=l(7220),ee=l(4458),te=l(3190),le=l(3119),se=l(3358),ae=l(9984),re=l.n(ae);const ie=(0,N.Z)(J,[["render",H]]),oe=ie;re()(J,"components",{QSeparator:Y.Z,QPage:B.Z,QBanner:L.Z,QCheckbox:K.Z,QTable:M.Z,QBtn:$.Z,QTr:G.Z,QTd:X.Z,QCard:ee.Z,QCardSection:te.Z,QInput:le.Z,QSpinnerHourglass:se.Z})}}]);