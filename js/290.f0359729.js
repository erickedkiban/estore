"use strict";(globalThis["webpackChunkfirebaseaut"]=globalThis["webpackChunkfirebaseaut"]||[]).push([[290],{6290:(e,t,l)=>{l.r(t),l.d(t,{default:()=>re});var s=l(9835),a=l(6970);const i={class:"row"},o=(0,s._)("div",{class:"col-8"},null,-1),r={class:"col-4"},n={class:"row"},d={key:0,class:"col-8"},c={key:1,class:"col-8"},u={class:"text-h5 text-weight-light text-uppercase q-mb-sm"},p={class:"flex justify-end"},m={class:"q-pt-lg q-pb-lg",style:{width:"100%"}},g={class:"flex items-center"},w={class:"q-mr-md"},v=["src"],h={class:"q-ml-md"},f={class:"col-4"},y={class:"q-pl-xl"},b=(0,s._)("div",{class:"text-h5 text-weight-light text-uppercase"}," Payable Amount ",-1),x={class:"text-h5 text-weight-light text-uppercase q-mb-md",style:{color:"#d89f65"}},_=(0,s._)("div",{class:"flex justify-between q-mt-lg"},null,-1),k={class:"flex justify-between items-center"},q=(0,s._)("div",null,[(0,s._)("div",{class:"text-subtitle2 text-uppercase"}," Add Cash Received: ")],-1),P={class:"q-pt-md q-pb-md"},I={class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},C=(0,s._)("div",null,"Subtotal",-1),T={class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},W=(0,s._)("div",null,"Change",-1),O={key:0},Z={key:1},Q=(0,s._)("div",{class:"text-subtitle1 text-uppercase text-weight-medium flex justify-between"},[(0,s._)("div",null,[(0,s.Uk)(" Service Charge "),(0,s._)("span",{class:"text-weight-light q-ml-sm"},"0%")]),(0,s._)("div",null,"0")],-1),j={class:"flex justify-between text-uppercase text-weight-light text-h5"},R=(0,s._)("div",null,"Total",-1),z={class:"q-mt-xl"},D={key:0};function E(e,t,l,E,H,U){const J=(0,s.up)("q-separator"),S=(0,s.up)("q-banner"),V=(0,s.up)("q-checkbox"),A=(0,s.up)("q-btn"),F=(0,s.up)("q-td"),L=(0,s.up)("q-tr"),N=(0,s.up)("q-table"),Y=(0,s.up)("q-input"),B=(0,s.up)("q-card-section"),K=(0,s.up)("q-card"),M=(0,s.up)("q-spinner-hourglass"),$=(0,s.up)("q-page");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",i,[o,(0,s._)("div",r,[(0,s.Wm)(J,{vertical:"",style:{color:"#d8dbd9",height:"100vh",position:"fixed","margin-left":"15px"}})])]),(0,s.Wm)($,{class:"q-ma-lg",style:{"min-height":"0 !important"}},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s._)("div",n,[0===E.orders.length?((0,s.wg)(),(0,s.iD)("div",d,[(0,s.Wm)(S,{"inline-actions":"",class:"text-white bg-red"},{default:(0,s.w5)((()=>[(0,s.Uk)(" No order found. ")])),_:1})])):((0,s.wg)(),(0,s.iD)("div",c,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(Object.keys(E.segregatedOrders),(e=>((0,s.wg)(),(0,s.iD)("div",{key:e},[(0,s._)("div",u," order #: "+(0,a.zw)(e),1),(0,s._)("div",p,[(0,s.Wm)(V,{style:{position:"relative",top:"-10px"},modelValue:E.selectedTables,"onUpdate:modelValue":t[0]||(t[0]=e=>E.selectedTables=e),val:e,dense:""},null,8,["modelValue","val"])]),(0,s.Wm)(N,{class:"q-mb-lg",flat:"",bordered:"",title:"Treats",columns:E.columns,"row-key":"name","binary-state-sort":"",rows:E.segregatedOrders[e],pagination:E.pagination},{top:(0,s.w5)((()=>[(0,s._)("div",m,[(0,s.Wm)(A,{push:"",class:"text-uppercase text-black text-weight-light full-width text-h6",color:"red",label:"Cancel Order",onClick:t=>E.cancelOrder(e)},null,8,["onClick"])])])),body:(0,s.w5)((t=>[(0,s.Wm)(L,{props:t},{default:(0,s.w5)((()=>[(0,s.Wm)(F,{key:"item",props:t},{default:(0,s.w5)((()=>[(0,s._)("div",g,[(0,s._)("span",w,(0,a.zw)(t.rowIndex+1),1),(0,s._)("img",{src:t.row.image,alt:"Item Image",style:{width:"50px",height:"50px","object-fit":"cover"}},null,8,v),(0,s._)("span",h,(0,a.zw)(t.row.name),1)])])),_:2},1032,["props"]),(0,s.Wm)(F,{key:"price",props:t},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(t.row.price),1)])),_:2},1032,["props"]),(0,s.Wm)(F,{key:"qty",props:t},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(t.row.order_quantity),1)])),_:2},1032,["props"]),(0,s.Wm)(F,{key:"actions",props:t},{default:(0,s.w5)((()=>[(0,s.Wm)(A,{onClick:l=>E.removeItem(t.row.itemId,e,t.row.name),color:"red",icon:"delete"},null,8,["onClick"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},1032,["columns","rows","pagination"])])))),128))])),(0,s._)("div",f,[(0,s._)("div",y,[b,(0,s._)("div",x," P"+(0,a.zw)(E.totalPrice),1),(0,s.Wm)(J,{style:{color:"#d8dbd9"}}),_,(0,s._)("div",null,[(0,s.Wm)(K,{class:"q-mt-lg",style:{background:"#eaf0f0"}},{default:(0,s.w5)((()=>[(0,s.Wm)(B,null,{default:(0,s.w5)((()=>[(0,s._)("div",k,[q,(0,s._)("div",null,[(0,s.Wm)(Y,{"input-style":{fontSize:"20px"},modelValue:E.cashReceived,"onUpdate:modelValue":t[1]||(t[1]=e=>E.cashReceived=e),dense:E.dense},null,8,["modelValue","dense"])])])])),_:1})])),_:1})]),(0,s._)("div",P,[(0,s._)("div",I,[C,(0,s._)("div",null,"P"+(0,a.zw)(E.totalPrice),1)]),(0,s._)("div",T,[W,E.cashReceived>E.totalPrice?((0,s.wg)(),(0,s.iD)("div",O," P"+(0,a.zw)(E.cashReceived-E.totalPrice),1)):((0,s.wg)(),(0,s.iD)("div",Z,"P0"))]),Q]),(0,s.Wm)(J,{class:"q-mb-xl",style:{color:"#d8dbd9"}}),(0,s._)("div",j,[R,(0,s._)("div",null,"P"+(0,a.zw)(E.totalPrice),1)]),(0,s._)("div",z,[!E.cashReceived||E.cashReceived<E.totalPrice||!E.totalPrice?((0,s.wg)(),(0,s.j4)(A,{key:0,disabled:"",style:{background:"#8bb5be",width:"100%"},class:"text-uppercase text-h5"},{default:(0,s.w5)((()=>[(0,s.Uk)("Pay Now")])),_:1})):((0,s.wg)(),(0,s.j4)(A,{key:1,onClick:E.paynow,style:{background:"#8bb5be",width:"100%"},class:"text-uppercase text-h5",disable:E.loading},{default:(0,s.w5)((()=>[E.loading?((0,s.wg)(),(0,s.j4)(M,{key:1,color:"white"})):((0,s.wg)(),(0,s.iD)("span",D,"Pay Now"))])),_:1},8,["onClick","disable"]))])])])])])])),_:1})],64)}l(9665),l(6727);var H=l(499),U=l(9302),J=(l(6827),l(222)),S=l(6605),V=l(9017);const A=[{name:"item",required:!0,label:"ITEM",align:"left",field:e=>e.name,sortable:!0},{name:"price",align:"left",label:"PRICE",field:e=>e.price,sortable:!0},{name:"qty",align:"left",label:"QTY",field:e=>e.order_quantity,sortable:!0},{name:"actions",align:"right",label:"Actions",field:"actions",sortable:!0}],F={setup(){const e=(0,H.iH)(!1),t=(0,U.Z)(),l=(0,H.iH)([]),a=(0,H.iH)(null),i=(0,H.iH)(""),o=(0,H.iH)([]),r=(0,s.FN)().appContext.config.globalProperties,n=(0,J.ZF)(r.$firebaseConfig),d=(0,V.ad)(n);let c;const u=(0,H.iH)({page:1,rowsPerPage:10,sortBy:"desc",descending:!1}),p=(0,s.Fl)((()=>{const e=[];for(const t of l.value)g.value.hasOwnProperty(t)&&e.push(...g.value[t]);return e})),m=(0,s.Fl)((()=>p.value.reduce(((e,t)=>e+t.total),0))),g=(0,s.Fl)((()=>{const e={};return o.value.forEach((t=>{const l=t.orderId;e[l]||(e[l]=[]);const s=t.orders.map((e=>{const t=e.price*e.order_quantity;return{...e,total:t,actions:null}}));e[l].push(...s)})),e}));async function w(){const e=(0,S.v0)().currentUser;if(t.loading.hide(),e){const t=(0,V.IO)((0,V.hJ)(d,"orders")),l=await(0,V.PL)(t),s=[];l.docs.forEach((t=>{const l=t.data();Array.isArray(l.orders)&&l.orders.length>0&&l.userId===e.uid&&"unpaid"===l.payment_status&&s.push(l)})),o.value=s}}async function v(e){const t=(0,V.IO)((0,V.hJ)(d,"orders"),(0,V.ar)("orderId","==",e)),l=await(0,V.PL)(t);l.forEach((async e=>{await(0,V.oe)(e.ref)})),o.value=o.value.filter((t=>t.orderId!==e))}async function h(){const s=(0,S.v0)().currentUser;if(s){const s=l.value,r=o.value.filter((e=>s.includes(e.orderId)));if(console.log("Selected Order IDs:",s),console.log("Matching Orders:",r),r.length>0){const o=a.value,n=m.value;if(!o||o<n)return void t.notify({message:"Please input cash received",position:"top",timeout:2e3,color:"red"});const c=o-n;try{e.value=!0;for(const e of s){const t=(0,V.IO)((0,V.hJ)(d,"orders"),(0,V.ar)("orderId","==",e)),l=await(0,V.PL)(t);l.forEach((async e=>{const t=e.ref;console.log("Order Doc Ref:",t),await(0,V.r7)(t,{payment_status:"paid"})}))}const i={orders:r.map((e=>({...e,payment_status:"paid"}))),cashReceived:o,change:c>0?c:0,timestamp:V.EK.now()},n=(0,V.hJ)(d,"report");await(0,V.ET)(n,i),l.value=[],a.value=null,setTimeout((()=>{e.value=!1,t.notify({message:"Payment successful!",position:"top",timeout:2e3})}),500),await w()}catch(i){console.error("Error while processing payment:",i),e.value=!1}}}}async function f(l,s,a){try{const i=(0,V.ad)(n),o=(0,V.IO)((0,V.hJ)(i,"orders"),(0,V.ar)("orderId","==",s)),r=await(0,V.PL)(o);if(!r.empty){const s=r.docs[0],o=(0,V.JU)(i,"orders",s.id),n=s.data(),d=n.orders.findIndex((e=>e.itemId===l&&e.name===a));-1!==d&&(n.orders.splice(d,1),await(0,V.pl)(o,n)),setTimeout((()=>{e.value=!1,t.notify({message:"Item Removed successfully!",position:"top",timeout:2e3,color:"red"})}),500),await w()}}catch(i){console.error("Error removing item:",i)}}return(0,s.YP)(l,(e=>{0===e.length&&(a.value=null)})),(0,s.bv)((()=>{w(),t.loading.show(),c=setTimeout((()=>{t.loading.hide(),c=void 0}),2e3)})),(0,s.Jd)((()=>{void 0!==c&&(clearTimeout(c),t.loading.hide())})),{removeItem:f,loading:e,paynow:h,selectedTables:l,cashReceived:a,uuid:i,orders:o,columns:A,selectedOrders:p,totalPrice:m,segregatedOrders:g,cancelOrder:v,dense:(0,H.iH)(!1),pagination:u,timer:c}}};var L=l(1639),N=l(926),Y=l(9885),B=l(7128),K=l(1221),M=l(6008),$=l(4455),G=l(3532),X=l(7220),ee=l(4458),te=l(3190),le=l(3119),se=l(3358),ae=l(9984),ie=l.n(ae);const oe=(0,L.Z)(F,[["render",E]]),re=oe;ie()(F,"components",{QSeparator:N.Z,QPage:Y.Z,QBanner:B.Z,QCheckbox:K.Z,QTable:M.Z,QBtn:$.Z,QTr:G.Z,QTd:X.Z,QCard:ee.Z,QCardSection:te.Z,QInput:le.Z,QSpinnerHourglass:se.Z})}}]);